window;import{jsxs as n,Fragment as e,jsx as r}from"react/jsx-runtime";import*as t from"react";function o(n){return n.trim().split(/\s+/).map((n=>{let e=n.replace(/^[()\[\]{}:,]+|[()\[\]{}:,]+$/g,"");if(/^-?\d+(?:\.\d+)?$/.test(e))return e;if(e.includes(".")){const n=e.split(".");e=n[n.length-1]||e}return e})).filter((n=>n.length>0)).join(" ")}function a(n,e){if(n===e)return!0;if(null==n||null==e)return n===e;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!a(n[r],e[r]))return!1;return!0}if("object"==typeof n&&"object"==typeof e){const r=n,t=e,o=Object.keys(r),i=Object.keys(t);if(o.length!==i.length)return!1;for(const n of o){if(!(n in t))return!1;if(!a(r[n],t[n]))return!1}return!0}return!1}function i(n,e){const r=new Set,t=Math.max(n.length,e.length);for(let o=0;o<t;o++)o>=n.length||o>=e.length?r.add(o):a(n[o],e[o])||r.add(o);return r}function d(n,t=", "){const o=[];return n.forEach(((e,a)=>{o.push(r("span",{children:e},`n-${a}`)),a<n.length-1&&o.push(r("span",{children:t},`s-${a}`))})),r(e,{children:o})}function s(e,t,a){const i=void 0!==t;if(Array.isArray(e)){const r=e.map(((n,e)=>s(n,t)));return n("code",{children:["[",d(r),"]"]})}if("object"==typeof e&&null!==e){const n=JSON.stringify(e);return r("code",i?{className:"changed-element",children:n}:{children:n})}if("string"==typeof e){const n=o(e);return r("code",i?{className:"changed-element",children:n}:{children:n})}const c=String(e);return r("code",i?{className:"changed-element",children:c}:{children:c})}function c(e,t,o){const a=void 0!==t&&void 0!==o&&t.has(o);if(Array.isArray(e)){if(2===e.length){const t=s(e[0]),o=s(e[1]),i=n("code",{children:["(",t,", ",o,")"]});return a?r("span",{className:"changed-element",children:i}):i}{const n=s(e);return a?r("span",{className:"changed-element",children:n}):n}}return l(e)}function l(e,t){if(Array.isArray(e)){if(0===e.length)return r("code",{children:"[]"});if(2===e.length&&!Array.isArray(e[0])&&!Array.isArray(e[1])){const r=l(e[0]),t=l(e[1]);return n("code",{children:["(",r,","," ",t,")"]})}return e.some(Array.isArray)?r("ul",{className:"list",children:e.map(((n,e)=>r("li",{children:c(n,t,e)},e)))}):function(e,t){const o=[];return e.forEach(((n,a)=>{const i=void 0!==t&&t.has(a),d=s(n);o.push(r("span",i?{className:"changed-element",children:d}:{children:d},a)),a<e.length-1&&o.push(r("span",{children:", "},`comma-${a}`))})),n("code",{children:["[",o,"]"]})}(e,t)}return r("code","object"==typeof e&&null!==e?{children:JSON.stringify(e)}:"string"==typeof e?{children:o(e)}:{children:String(e)})}function p(n){if(Array.isArray(n))return n.length>0&&Array.isArray(n[0])?`Array(${n.length}) of tuples`:`Array(${n.length})`;if("object"==typeof n&&null!==n)try{return JSON.stringify(n).slice(0,80)+"…"}catch{return"[object]"}if("string"==typeof n){const e=o(n).replace(/\s+/g," ");return e.length>80?e.slice(0,80)+"…":e}return String(n)}const h=({k:e,v:o,changeInfo:a})=>{const i=function(n){return!!Array.isArray(n)||"object"==typeof n&&null!==n||!("string"!=typeof n||!(n.includes("\n")||n.length>60))}(o),d="full"===a?.type||"array"===a?.type,[s,c]=t.useState(!i||d),h=s&&"array"===a?.type?a.changedIndices:void 0;return n("div",{className:`kv-row ${i?"has-toggle":""} ${d?"changed":""}`,children:[r("div",{className:"kv-key",children:r("code",{children:e})}),r("div",{className:"kv-sep",children:"↦"}),n("div",{className:"kv-val "+(s?"expanded":"collapsed"),children:[i&&r("button",{className:"kv-toggle",type:"button",onClick:()=>c((n=>!n)),"aria-label":s?"Collapse value":"Expand value",title:s?"Collapse":"Expand",children:s?"▼":"▶"}),r("div",{className:"kv-content",children:s?l(o,h):r("code",{children:p(o)})})]})]})},g=({st:e,highlighted:a=!1,changes:i})=>{const[d,s]=t.useState(!0),c=Object.entries(e.fields);return n("div",{className:"state-card "+(a?"is-highlighted":""),children:[n("div",{className:"state-header",onClick:()=>s((n=>!n)),children:[n("div",{className:"state-title",children:[r("span",{className:"action-chip",title:e.tag??"",children:e.tag?o(e.tag):"(no action)"}),n("span",{className:"state-id",children:["(index: ",e.index,")"]})]}),r("div",{className:"state-toggle",children:d?"▼":"▶"})]}),d&&r("div",{className:"state-body",children:r("div",{className:"kv-table",children:c.map((([n,e])=>r(h,{k:n,v:e,changeInfo:i?.get(n)},n)))})})]})},u=({trace:t,layout:o="vertical"})=>{const d="vertical"===o;return n(e,{children:[r("style",{children:'\n    .mc-root {\n      font-family: system-ui, -apple-system, sans-serif;\n      max-width: 100%;\n      overflow: auto;\n    }\n    .mc-trace.vertical {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      padding: 8px;\n    }\n    .mc-trace.horizontal {\n      display: flex;\n      flex-direction: row;\n      gap: 8px;\n      padding: 8px;\n      overflow-x: auto;\n    }\n    .mc-summary {\n      margin: 12px 8px;\n      padding: 8px 12px;\n      background: var(--vscode-editorWidget-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 4px;\n    }\n    .state-card {\n      --border: var(--vscode-panel-border);\n      --header: var(--vscode-editorGroupHeader-tabsBackground);\n      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;\n      background: var(--vscode-editorWidget-background);\n      border: 1px solid var(--border);\n      border-radius: 6px;\n      min-width: 320px;\n      max-width: 720px;\n      box-shadow: 0 1px 2px rgba(0,0,0,.08);\n      overflow: hidden;\n    }\n    .state-card.is-highlighted {\n      outline: 2px solid var(--vscode-editor-selectionHighlightBorder);\n      box-shadow: 0 0 0 3px var(--vscode-editor-selectionBackground);\n    }\n    .state-header {\n      background: var(--header);\n      border-bottom: 1px solid var(--border);\n      padding: 6px 10px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      font-weight: 600;\n      cursor: pointer;\n    }\n    .state-title {\n      display: flex;\n      gap: 6px;\n      align-items: baseline;\n    }\n    .state-id { font-size: 12px; color: var(--vscode-descriptionForeground); }\n    .state-toggle { font-size: 12px; color: var(--vscode-descriptionForeground); user-select: none; }\n    .action-chip {\n      display: inline-block;\n      font-family: var(--mono);\n      font-size: 11px;\n      font-weight: normal;\n      background: var(--vscode-activityBarBadge-background);\n      color: var(--vscode-activityBarBadge-foreground);\n      border: 1px solid var(--vscode-activityBarBadge-foreground);\n      border-radius: 999px;\n      padding: 2px 8px;\n      line-height: 1.4;\n    }\n    .state-body { padding: 10px; }\n    .kv-table {\n      border: 1px solid var(--border);\n      border-radius: 4px;\n      overflow: hidden;\n    }\n    .kv-row {\n      display: grid;\n      grid-template-columns: 1fr auto 2fr;\n      gap: 8px;\n      padding: 4px 10px;\n      align-items: baseline;\n      border-bottom: 1px solid var(--vscode-panel-border);\n      background: var(--vscode-editor-background);\n      transition: background-color .15s ease, border-left-color .15s ease;\n      border-left: 3px solid transparent;\n    }\n    .kv-row:last-child { border-bottom: none; }\n    .kv-row.changed {\n      background: var(--vscode-editor-findMatchHighlightBackground);\n      border-left: 3px solid var(--vscode-editor-findMatchHighlightBorder);\n      color: var(--vscode-editor-foreground);\n    }\n    .changed-element {\n      background: var(--vscode-editor-findMatchBackground);\n      border-radius: 3px;\n      padding: 2px 4px;\n      box-shadow: 0 0 0 2px var(--vscode-editor-findMatchBorder);\n      color: var(--vscode-editor-foreground);\n    }\n    .kv-key {\n      font-family: var(--mono);\n      background: transparent;\n      word-break: break-all;\n      font-size: 11px;\n    }\n    .kv-sep { color: var(--vscode-descriptionForeground); background: transparent; }\n    .kv-val {\n      font-family: var(--mono);\n      font-size: 11px;\n      background: transparent;\n      word-break: break-all;\n      display: flex; align-items: flex-start; gap: 6px;\n    }\n    .kv-toggle {\n      border: none; background: transparent; font-size: 12px; line-height: 1;\n      cursor: pointer; color: var(--vscode-descriptionForeground); padding: 0 2px;\n    }\n    .kv-val.collapsed .kv-content code {\n      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;\n    }\n    // .kv-content { display: block; }\n    ul.list {\n      margin: 4px 0 0 1rem;\n      padding: 0;\n      list-style-position: outside;\n    }\n    ul.list li {\n      font-family: var(--mono);\n      font-size: 11px;\n      line-height: 1.4;\n      background: transparent;\n      color: var(--vscode-foreground);\n      margin: 2px 0;\n    }\n    code {\n      background: transparent;\n      color: var(--vscode-foreground);\n      padding: 2px 4px;\n      border-radius: 3px;\n      font-family: var(--mono);\n    }\n    .kv-val.collapsed .kv-content code {\n      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;\n    }\n    .kv-content { display: block; }\n    .action-chip { cursor: help; }\n  '}),n("div",{className:"mc-root",children:[r("div",{className:"mc-trace "+(d?"vertical":"horizontal"),children:t.map(((n,e)=>{const o=function(n,e){const r=new Map;if(!n)return r;const t=new Set([...Object.keys(n),...Object.keys(e)]);for(const o of t){if(!(o in n)||!(o in e)){r.set(o,{type:"full"});continue}const t=n[o],d=e[o];if(!a(t,d))if(Array.isArray(t)&&Array.isArray(d)){const n=i(t,d);n.size>0&&r.set(o,{type:"array",changedIndices:n})}else r.set(o,{type:"full"})}return r}(e>0?t[e-1].fields:void 0,n.fields);return r(g,{st:n,changes:o},n.index)}))}),n("div",{className:"mc-summary",children:[r("strong",{children:"Summary:"})," ",t.length," states"]})]})]})};export{u as default};