window;import{jsxs as e,jsx as t,Fragment as n}from"react/jsx-runtime";import*as r from"react";import a from"react";import{useRpcSession as o,EnvPosContext as s,useAsyncPersistent as i,mapRpcError as c,importWidgetModule as l}from"@leanprover/infoview";async function m(a,o,s){if("text"in s)return t(n,{children:s.text});if("element"in s){const[e,n,i]=s.element,c={};for(const[e,t]of n)c[e]=t;const l=await Promise.all(i.map((async e=>await m(a,o,e))));return"hr"===e?t("hr",{}):0===l.length?r.createElement(e,c):r.createElement(e,c,l)}if("component"in s){const[e,t,n,i]=s.component,c=await Promise.all(i.map((async e=>await m(a,o,e)))),f={...n,pos:o},u=await l(a,o,e);if(!(t in u))throw new Error(`Module '${e}' does not export '${t}'`);return 0===c.length?r.createElement(u[t],f):r.createElement(u[t],f,c)}return e("span",{className:"red",children:["Unknown HTML variant: ",JSON.stringify(s)]})}function f({html:a}){const l=o(),f=r.useContext(s),u=i((()=>m(l,f,a)),[l,f,a]);return"resolved"===u.state?u.value:"rejected"===u.state?e("span",{className:"red",children:["Error rendering HTML: ",c(u.error).message]}):t(n,{})}function u(e){const r=o(),[s,i]=a.useState(null);return a.useEffect((()=>{let t=!1;async function n(a){const o=await r.call("ProofWidgets.RefreshComponent.awaitRefresh",{oldIdx:a,state:e.state});if(!t&&o)return i(o.html),n(o.idx)}return(async()=>{const a=await r.call("ProofWidgets.RefreshComponent.getCurrState",e.state);if(!t)i(a.html),n(a.idx)})(),()=>{t=!0,e.cancelTk&&r.call("ProofWidgets.RefreshComponent.cancelRefresh",e.cancelTk)}}),[e]),s?t(f,{html:s}):t(n,{})}export{u as default};