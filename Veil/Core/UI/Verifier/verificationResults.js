window;import{jsxs as n,jsx as e,Fragment as r}from"react/jsx-runtime";import*as o from"react";import{useRpcSession as t,EnvPosContext as a,useAsyncPersistent as s,mapRpcError as i,importWidgetModule as d}from"@leanprover/infoview";async function c(t,a,s){if("text"in s)return e(r,{children:s.text});if("element"in s){const[n,r,i]=s.element,d={};for(const[n,e]of r)d[n]=e;const l=await Promise.all(i.map((async n=>await c(t,a,n))));return"hr"===n?e("hr",{}):0===l.length?o.createElement(n,d):o.createElement(n,d,l)}if("component"in s){const[n,e,r,i]=s.component,l=await Promise.all(i.map((async n=>await c(t,a,n)))),p={...r,pos:a},u=await d(t,a,n);if(!(e in u))throw new Error(`Module '${n}' does not export '${e}'`);return 0===l.length?o.createElement(u[e],p):o.createElement(u[e],p,l)}return n("span",{className:"red",children:["Unknown HTML variant: ",JSON.stringify(s)]})}function l({html:d}){const l=t(),p=o.useContext(a),u=s((()=>c(l,p,d)),[l,p,d]);return"resolved"===u.state?u.value:"rejected"===u.state?n("span",{className:"red",children:["Error rendering HTML: ",i(u.error).message]}):e(r,{})}const p=({text:t,className:a})=>{const[s,i]=o.useState(!1);return n("button",{className:a,onClick:async()=>{try{await navigator.clipboard.writeText(t),i(!0),setTimeout((()=>i(!1)),2e3)}catch(n){console.error("Failed to copy:",n)}},title:"Copy to clipboard",children:[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s?e("path",{d:"M20 6L9 17l-5-5",strokeLinecap:"round",strokeLinejoin:"round"}):n(r,{children:[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]})}),s?"Copied!":"Copy JSON"]})};function u(n){switch(n){case"proven":return"âœ…";case"disproven":return"âŒ";case"unknown":return"â“";case"error":return"ðŸ’¥";case null:return e("span",{className:"spinner",children:"â³"});default:return"â­•"}}function v(o){const t="all"===o?"All":o.charAt(0).toUpperCase()+o.slice(1);switch(o){case"all":default:return t;case"pending":return n(r,{children:[e("span",{className:"spinner-small",children:"â³"})," ",t]});case"proven":return n(r,{children:["âœ… ",t]});case"disproven":return n(r,{children:["âŒ ",t]});case"unknown":return n(r,{children:["â“ ",t]});case"error":return n(r,{children:["ðŸ’¥ ",t]})}}const g=({vc:t})=>{const[a,s]=o.useState(!1),i=(()=>{if("disproven"!==t.status)return null;for(const n of t.timing.dischargers){const e=n.result?.data?.counterexamples;if(e&&e.length>0)return e[0]}return null})(),d=null!==i;return n(r,{children:[n("div",{className:`property-row status-${p=t.status,p||"pending"} ${d?"expandable":""}`,onClick:()=>d&&s(!a),style:{cursor:d?"pointer":"default"},children:[d&&e("span",{className:"property-toggle",children:a?"â–¼":"â–¶"}),e("span",{className:"property-icon",children:u(t.status)}),e("span",{className:"property-name",children:t.metadata.property}),null!==t.timing.totalTime&&e("span",{className:"property-time",children:(c=t.timing.totalTime,null===c?null:c<1e3?`${c}ms`:`${(c/1e3).toFixed(2)}s`)})]}),a&&i&&n("div",{className:"counterexample-container",children:[e("div",{className:"counterexample-label",children:"Counterexample:"}),e("div",{className:"counterexample-content",children:e(l,{html:i.html})})]})]});var c,p},b=({action:r,vcs:t})=>{const[a,s]=o.useState(!0);return n("div",{className:"action-section",children:[n("div",{className:"action-header",onClick:()=>s(!a),children:[e("span",{className:"action-toggle",children:a?"â–¼":"â–¶"}),e("span",{className:"action-name",children:r})]}),a&&e("div",{className:"action-properties",children:t.map((n=>e(g,{vc:n},n.id)))})]})},m=({results:t})=>{const[a,s]=o.useState("all"),[i,d]=o.useState(!1),c=o.useMemo((()=>{const n=(n,e)=>{const r=n.replace("#","");return`rgba(${parseInt(r.substring(0,2),16)}, ${parseInt(r.substring(2,4),16)}, ${parseInt(r.substring(4,6),16)}, ${e})`};return{proven:{border:"#52c41a",bg:n("#52c41a",.1)},disproven:{border:"#ff4d4f",bg:n("#ff4d4f",.1)},error:{border:"#fa8c16",bg:n("#fa8c16",.1)},unknown:{border:"#1890ff",bg:n("#1890ff",.1)},pending:{border:"#d9d9d9",bg:n("#d9d9d9",.05)}}}),[]),l=o.useMemo((()=>{const n={all:t.vcs.length,pending:0,proven:0,disproven:0,unknown:0,error:0};return t.vcs.forEach((e=>{null===e.status?n.pending++:"proven"===e.status?n.proven++:"disproven"===e.status?n.disproven++:"unknown"===e.status?n.unknown++:"error"===e.status&&n.error++})),n}),[t.vcs]),u=o.useMemo((()=>"all"===a?t.vcs:"pending"===a?t.vcs.filter((n=>null===n.status)):t.vcs.filter((n=>n.status===a))),[t.vcs,a]),m=o.useMemo((()=>function(n){const e=new Map;for(const r of n){const n=r.metadata.action;e.has(n)||e.set(n,[]),e.get(n).push(r)}return e}(u)),[u]),f=m.get("initializer")||[],x=Array.from(m.entries()).filter((([n])=>"initializer"!==n)),h=o.useMemo((()=>`\n    .vr-root {\n      font-family: system-ui, -apple-system, sans-serif;\n      max-width: 100%;\n      padding: 16px;\n      background: var(--vscode-editor-background);\n      border-radius: 8px;\n    }\n\n    .vr-filters {\n      display: flex;\n      gap: 8px;\n      margin-bottom: 16px;\n      padding: 12px;\n      background: var(--vscode-editorWidget-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 6px;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n\n    .vr-filter-label {\n      font-weight: 600;\n      font-size: 14px;\n      color: var(--vscode-foreground);\n    }\n\n    .vr-filter-button {\n      padding: 6px 12px;\n      border: 1px solid var(--vscode-panel-border);\n      background: var(--vscode-editorWidget-background);\n      color: var(--vscode-foreground);\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 13px;\n      transition: all 0.2s;\n    }\n\n    .vr-filter-button:hover {\n      background: var(--vscode-list-hoverBackground);\n      border-color: var(--vscode-panel-border);\n    }\n\n    .vr-filter-button.active {\n      background: var(--vscode-button-background);\n      color: var(--vscode-button-foreground);\n      border-color: var(--vscode-button-background);\n    }\n\n    .vr-section {\n      margin-bottom: 24px;\n      background: var(--vscode-editorWidget-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 6px;\n      overflow: hidden;\n    }\n\n    .vr-section-title {\n      font-weight: 600;\n      font-size: 16px;\n      padding: 12px 16px;\n      background: var(--vscode-editorGroupHeader-tabsBackground);\n      border-bottom: 1px solid var(--vscode-panel-border);\n      color: var(--vscode-foreground);\n    }\n\n    .vr-section-content {\n      padding: 12px;\n    }\n\n    .action-section {\n      margin-bottom: 12px;\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 4px;\n      overflow: hidden;\n    }\n\n    .action-header {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 10px 12px;\n      background: var(--vscode-editorWidget-background);\n      cursor: pointer;\n      user-select: none;\n      transition: background 0.2s;\n    }\n\n    .action-header:hover {\n      background: var(--vscode-list-hoverBackground);\n    }\n\n    .action-toggle {\n      font-size: 12px;\n      color: var(--vscode-descriptionForeground);\n    }\n\n    .action-name {\n      font-weight: 600;\n      font-size: 14px;\n      color: var(--vscode-foreground);\n    }\n\n    .action-properties {\n      padding: 8px 12px 8px 32px;\n      background: var(--vscode-editorWidget-background);\n    }\n\n    .property-row {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 6px 8px;\n      margin: 2px 0;\n      border-radius: 4px;\n      transition: background 0.15s;\n    }\n\n    .property-row:hover {\n      background: var(--vscode-list-hoverBackground);\n    }\n\n    .property-icon {\n      font-size: 16px;\n      flex-shrink: 0;\n    }\n\n    .property-name {\n      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;\n      font-size: 13px;\n      color: var(--vscode-editor-foreground);\n      flex-grow: 1;\n    }\n\n    .property-time {\n      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;\n      font-size: 12px;\n      margin-left: auto;\n      padding: 2px 6px;\n      background: var(--vscode-editorWidget-background);\n      color: var(--vscode-descriptionForeground);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 6px;\n      white-space: nowrap;\n    }\n\n    .property-row.status-proven {\n      background: ${c.proven.bg};\n      border-left: 3px solid ${c.proven.border};\n    }\n\n    .property-row.status-disproven {\n      background: ${c.disproven.bg};\n      border-left: 3px solid ${c.disproven.border};\n    }\n\n    .property-row.status-error {\n      background: ${c.error.bg};\n      border-left: 3px solid ${c.error.border};\n    }\n\n    .property-row.status-unknown {\n      background: ${c.unknown.bg};\n      border-left: 3px solid ${c.unknown.border};\n    }\n\n    .property-row.status-pending {\n      background: ${c.pending.bg};\n      border-left: 3px solid ${c.pending.border};\n    }\n\n    .spinner {\n      display: inline-block;\n      animation: spin 2s linear infinite;\n    }\n\n    .spinner-small {\n      display: inline-block;\n      font-size: 14px;\n    }\n\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n\n    .vr-empty {\n      padding: 24px;\n      text-align: center;\n      color: var(--vscode-disabledForeground);\n      font-style: italic;\n    }\n\n    .property-row.expandable:hover {\n      background: var(--vscode-list-activeSelectionBackground);\n      opacity: 0.9;\n    }\n\n    .property-toggle {\n      font-size: 12px;\n      color: var(--vscode-descriptionForeground);\n      margin-right: 4px;\n      flex-shrink: 0;\n    }\n\n    .counterexample-container {\n      margin-left: 32px;\n      margin-top: 8px;\n      margin-bottom: 8px;\n      padding: 12px;\n      background: var(--vscode-editorWidget-background);\n      border-left: 3px solid #ff4d4f;\n      border-radius: 4px;\n      overflow-x: auto;\n    }\n\n    .counterexample-label {\n      font-weight: 600;\n      font-size: 12px;\n      color: var(--vscode-descriptionForeground);\n      margin-bottom: 8px;\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n    }\n\n    .counterexample-content {\n      font-size: 13px;\n      color: var(--vscode-editor-foreground);\n    }\n\n    .counterexample-column-header {\n      text-align: left;\n    }\n\n    .vr-toolbar {\n      display: flex;\n      justify-content: flex-end;\n      padding: 4px 0;\n      margin-bottom: 8px;\n    }\n\n    .vr-toggle-link {\n      font-size: 11px;\n      color: var(--vscode-textLink-foreground);\n      cursor: pointer;\n      text-decoration: none;\n      background: none;\n      border: none;\n      padding: 2px 6px;\n      border-radius: 3px;\n    }\n\n    .vr-toggle-link:hover {\n      text-decoration: underline;\n      background: var(--vscode-toolbar-hoverBackground);\n    }\n\n    .vr-json-view {\n      position: relative;\n      background: var(--vscode-editor-background);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 6px;\n      max-height: 600px;\n    }\n    .vr-json-content {\n      padding: 12px;\n      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;\n      font-size: 12px;\n      white-space: pre;\n      overflow: auto;\n      max-height: 600px;\n    }\n    .vr-copy-button {\n      position: absolute;\n      top: 8px;\n      right: 8px;\n      display: inline-flex;\n      align-items: center;\n      gap: 4px;\n      font-size: 11px;\n      color: var(--vscode-foreground);\n      background: var(--vscode-button-secondaryBackground);\n      border: 1px solid var(--vscode-panel-border);\n      border-radius: 4px;\n      padding: 4px 8px;\n      cursor: pointer;\n      transition: background 0.15s, opacity 0.15s;\n      opacity: 0;\n    }\n    .vr-json-view:hover .vr-copy-button,\n    .vr-json-content:hover ~ .vr-copy-button {\n      opacity: 1;\n    }\n    .vr-copy-button:hover {\n      background: var(--vscode-button-secondaryHoverBackground);\n    }\n    .vr-copy-button svg {\n      width: 14px;\n      height: 14px;\n    }\n\n    .json-key { color: var(--vscode-symbolIcon-propertyForeground, #9cdcfe); }\n    .json-string { color: var(--vscode-symbolIcon-stringForeground, #ce9178); }\n    .json-number { color: var(--vscode-symbolIcon-numberForeground, #b5cea8); }\n    .json-boolean { color: var(--vscode-symbolIcon-booleanForeground, #569cd6); }\n    .json-null { color: var(--vscode-symbolIcon-nullForeground, #569cd6); }\n\n  `),[c]),k=JSON.stringify(t,null,2);return n(r,{children:[e("style",{children:h}),n("div",{className:"vr-root",children:[e("div",{className:"vr-toolbar",children:e("button",{className:"vr-toggle-link",onClick:()=>d(!i),children:i?"Show formatted":"Show JSON"})}),i?n("div",{className:"vr-json-view",children:[e(p,{text:k,className:"vr-copy-button"}),e("div",{className:"vr-json-content",children:(y=k,y.split(/("(?:[^"\\]|\\.)*"|\btrue\b|\bfalse\b|\bnull\b|-?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)/g).map(((n,r)=>{if(!n)return null;if(n.startsWith('"')){const o=-1!==y.indexOf(n+":")||-1!==y.indexOf(n+" :");return e("span",{className:o?"json-key":"json-string",children:n},r)}return"true"===n||"false"===n?e("span",{className:"json-boolean",children:n},r):"null"===n?e("span",{className:"json-null",children:n},r):/^-?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?$/.test(n)?e("span",{className:"json-number",children:n},r):e("span",{children:n},r)})))})]}):n(r,{children:[n("div",{className:"vr-filters",children:[n("span",{className:"vr-filter-label",children:["Filter by status (",t.totalVCs," VCs):"]}),["all","pending","proven","disproven","unknown","error"].map((e=>0===l[e]?null:n("button",{className:"vr-filter-button "+(a===e?"active":""),onClick:()=>s(e),children:[v(e)," (",l[e],")"]},e)))]}),0===u.length?e("div",{className:"vr-empty",children:"No verification conditions match the selected filter."}):n(r,{children:[f.length>0&&n("div",{className:"vr-section",children:[e("div",{className:"vr-section-title",children:"Initialization must establish the invariant:"}),e("div",{className:"vr-section-content",children:e("div",{className:"action-properties",children:f.map((n=>e(g,{vc:n},n.id)))})})]}),x.length>0&&n("div",{className:"vr-section",children:[e("div",{className:"vr-section-title",children:"The following set of actions must preserve the invariant:"}),e("div",{className:"vr-section-content",children:x.map((([n,r])=>e(b,{action:n,vcs:r},n)))})]})]})]})]})]});var y};export{m as default};