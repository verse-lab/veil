window;import{jsxs as n,Fragment as e,jsx as r}from"react/jsx-runtime";import*as t from"react";function a(n){if(!n.includes(".")||/^-?\d+\.\d+$/.test(n))return n;const e=n.split(".");return e[e.length-1]||n}function o(n,e){if(n===e)return!0;if(null==n||null==e)return n===e;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!o(n[r],e[r]))return!1;return!0}if("object"==typeof n&&"object"==typeof e){const r=n,t=e,a=Object.keys(r),i=Object.keys(t);if(a.length!==i.length)return!1;for(const n of a){if(!(n in t))return!1;if(!o(r[n],t[n]))return!1}return!0}return!1}function i(n,t=", "){const a=[];return n.forEach(((e,o)=>{a.push(r("span",{children:e},`n-${o}`)),o<n.length-1&&a.push(r("span",{children:t},`s-${o}`))})),r(e,{children:a})}function l(e){return Array.isArray(e)?n("code",{children:["[",i(e.map(l)),"]"]}):r("code","object"==typeof e&&null!==e?{children:JSON.stringify(e)}:"string"==typeof e?{children:a(e)}:{children:String(e)})}function s(e){if(Array.isArray(e)){if(2===e.length){const r=l(e[0]),t=l(e[1]);return n("code",{children:["(",r,", ",t,")"]})}return l(e)}return d(e)}function d(e){if(Array.isArray(e)){if(0===e.length)return r("code",{children:"[]"});if(2===e.length&&!Array.isArray(e[0])&&!Array.isArray(e[1])){const r=d(e[0]),t=d(e[1]);return n("code",{children:["(",r,","," ",t,")"]})}return e.some(Array.isArray)?r("ul",{className:"list",children:e.map(((n,e)=>r("li",{children:s(n)},e)))}):function(e){const t=[];return e.forEach(((n,a)=>{t.push(l(n)),a<e.length-1&&t.push(r("span",{children:", "},`comma-${a}`))})),n("code",{children:["[",t,"]"]})}(e)}return r("code","object"==typeof e&&null!==e?{children:JSON.stringify(e)}:"string"==typeof e?{children:a(e)}:{children:String(e)})}function c(n){if(Array.isArray(n))return n.length>0&&Array.isArray(n[0])?`Array(${n.length}) of tuples`:`Array(${n.length})`;if("object"==typeof n&&null!==n)try{return JSON.stringify(n).slice(0,80)+"…"}catch{return"[object]"}if("string"==typeof n){const e=a(n).replace(/\s+/g," ");return e.length>80?e.slice(0,80)+"…":e}return String(n)}const p=({k:e,v:a,changed:o})=>{const i=function(n){return!!Array.isArray(n)||"object"==typeof n&&null!==n||!("string"!=typeof n||!(n.includes("\n")||n.length>60))}(a),[l,s]=t.useState(!i);return n("div",{className:`kv-row ${i?"has-toggle":""} ${o?"changed":""}`,children:[r("div",{className:"kv-key",children:r("code",{children:e})}),r("div",{className:"kv-sep",children:"↦"}),n("div",{className:"kv-val "+(l?"expanded":"collapsed"),children:[i&&r("button",{className:"kv-toggle",type:"button",onClick:()=>s((n=>!n)),"aria-label":l?"Collapse value":"Expand value",title:l?"Collapse":"Expand",children:l?"▼":"▶"}),r("div",{className:"kv-content",children:l?d(a):r("code",{children:c(a)})})]})]})},f=({st:e,highlighted:o=!1,changedKeys:i})=>{const[l,s]=t.useState(!0),d=Object.entries(e.fields);return n("div",{className:"state-card "+(o?"is-highlighted":""),children:[n("div",{className:"state-header",onClick:()=>s((n=>!n)),children:[n("div",{className:"state-title",children:[r("span",{className:"action-chip",title:e.actionFull??e.action??"",children:e.action?a(e.action):"(no action)"}),n("span",{className:"state-id",children:["(index: ",e.index,")"]})]}),r("div",{className:"state-toggle",children:l?"▼":"▶"})]}),l&&r("div",{className:"state-body",children:r("div",{className:"kv-table",children:d.map((([n,e])=>r(p,{k:n,v:e,changed:i?.has(n)},n)))})})]})},h=({trace:t,layout:a="vertical"})=>{const i="vertical"===a;return n(e,{children:[r("style",{children:'\n    .mc-root {\n      font-family: system-ui, -apple-system, sans-serif;\n      max-width: 100%;\n      overflow: auto;\n    }\n    .mc-trace.vertical {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      padding: 8px;\n    }\n    .mc-trace.horizontal {\n      display: flex;\n      flex-direction: row;\n      gap: 8px;\n      padding: 8px;\n      overflow-x: auto;\n    }\n    .mc-summary {\n      margin: 12px 8px;\n      padding: 8px 12px;\n      background: #f8f9fa;\n      border: 1px solid #dee2e6;\n      border-radius: 4px;\n    }\n    .state-card {\n      --border: #bfbfbf;\n      --header: #e6e6e6;\n      --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;\n      background: #fff;\n      border: 1px solid var(--border);\n      border-radius: 6px;\n      min-width: 320px;\n      max-width: 720px;\n      box-shadow: 0 1px 2px rgba(0,0,0,.08);\n      overflow: hidden;\n    }\n    .state-card.is-highlighted {\n      outline: 2px solid #ffc107;\n      box-shadow: 0 0 0 3px rgba(255,193,7,.25);\n    }\n    .state-header {\n      background: var(--header);\n      border-bottom: 1px solid var(--border);\n      padding: 6px 10px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      font-weight: 600;\n      cursor: pointer;\n    }\n    .state-title {\n      display: flex;\n      gap: 6px;\n      align-items: baseline;\n    }\n    .state-id { font-size: 12px; color: #666; }\n    .state-toggle { font-size: 12px; color: #666; user-select: none; }\n    .action-chip {\n      display: inline-block;\n      font-family: var(--mono);\n      font-size: 11px;\n      font-weight: normal;\n      background: #eaf2ff;\n      color: #3b3b3dff;\n      border: 1px solid #a9c3feff;\n      border-radius: 999px;\n      padding: 2px 8px;\n      line-height: 1.4;\n    }\n    .state-body { padding: 10px; }\n    .kv-table {\n      border: 1px solid var(--border);\n      border-radius: 4px;\n      overflow: hidden;\n    }\n    .kv-row {\n      display: grid;\n      grid-template-columns: 1fr auto 2fr;\n      gap: 8px;\n      padding: 4px 10px;\n      align-items: baseline;\n      border-bottom: 1px solid #eee;\n      background: white;\n      transition: background-color .15s ease, border-left-color .15s ease;\n      border-left: 3px solid transparent;\n    }\n    .kv-row:last-child { border-bottom: none; }\n    .kv-row.changed {\n      background: #fff7e6;\n      border-left: 3px solid #faad14;\n    }\n    .kv-row.changed code { background: #fff1d6; }\n    .kv-key {\n      font-family: var(--mono);\n      background: transparent;\n      word-break: break-all;\n      font-size: 11px;\n    }\n    .kv-sep { color: #888; background: transparent; }\n    .kv-val {\n      font-family: var(--mono);\n      font-size: 11px;\n      background: transparent;\n      word-break: break-all;\n      display: flex; align-items: flex-start; gap: 6px;\n    }\n    .kv-toggle {\n      border: none; background: transparent; font-size: 12px; line-height: 1;\n      cursor: pointer; color: #666; padding: 0 2px;\n    }\n    .kv-val.collapsed .kv-content code {\n      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;\n    }\n    // .kv-content { display: block; }\n    ul.list {\n      margin: 4px 0 0 1rem;\n      padding: 0;\n      list-style-position: outside;\n    }\n    ul.list li {\n      font-family: var(--mono);\n      font-size: 11px;\n      line-height: 1.4;\n      background: transparent;\n      color: #333;\n      margin: 2px 0;\n    }\n    code {\n      background: transparent;\n      color: #333;\n      padding: 2px 4px;\n      border-radius: 3px;\n      font-family: var(--mono);\n    }\n    .kv-val.collapsed .kv-content code {\n      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;\n    }\n    .kv-content { display: block; }\n    .action-chip { cursor: help; }\n  '}),n("div",{className:"mc-root",children:[r("div",{className:"mc-trace "+(i?"vertical":"horizontal"),children:t.map(((n,e)=>{const a=function(n,e){const r=new Set;if(!n)return r;const t=new Set([...Object.keys(n),...Object.keys(e)]);for(const a of t)a in n&&a in e&&o(n[a],e[a])||r.add(a);return r}(e>0?t[e-1].fields:void 0,n.fields);return r(f,{st:n,changedKeys:a},n.index)}))}),n("div",{className:"mc-summary",children:[r("strong",{children:"Summary:"})," ",t.length," states"]})]})]})};export{h as default};